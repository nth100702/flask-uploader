{% extends "base.html" %}
{% block content %}

<form method="POST" action='/upload' class="dropzone dz-clickable" id="dropper" enctype="multipart/form-data">
</form>
<script type="application/javascript">
  // check if all entries fields are filled
  // var entriesForm = document.getElementById('entries');
  // var dropperForm = document.getElementById('dropper');
  // // initially hide the dropper form
  // dropperForm.style.display = 'none';
  // // upon every input, check if all fields are filled
  // entriesForm.addEventListener('input', function () {
  //   var allFilled = true;
  //   var inputs = entriesForm.querySelectorAll('#ma_nhan_vien, #ho_ten, #don_vi');
  //   inputs.forEach(function (input) {
  //     if (input.value === '') {
  //       allFilled = false;
  //     }
  //   });

  //   if (allFilled) {
  //     dropperForm.style.display = 'block';
  //   } else {
  //     dropperForm.style.display = 'none';
  //   }
  // });

  // dropzone config
  Dropzone.options.dropper = {
    paramName: 'file',
    // disable auto processing (uploading) of dropped files
    autoProcessQueue: false,
    init: function () {
      // register custom event handler on init
      let submitButton = document.querySelector("#submitBtn");
      submitButton.addEventListener("click", (e) => {
        e.preventDefault();
        // Process the queue
        this.processQueue();
      });

      // IMPORTANT: Only accepts valid filenames, else remove file from dropzone
      // fileadded event handler
      this.on("addedfile", file => {
        // TO-DO: validate file name
        regex = /GML-0001-NguyenVoMinhLuan-TacPhamDuThi/
        if (!regex.test(file.name)) {
          // this.removeFile(file);
          // show dropzone error message
          this.emit('error', file, 'Tên file không hợp lệ');
          // wait for 3s then remove file from dropzone
          setTimeout(() => {
            this.removeFile(file);
          }, 3000);
        }
      });
    },
    chunking: true,
    forceChunking: true,
    url: '/upload',
    maxFilesize: 500,
    chunkSize: 5000000, // in bytes: 1000000 bytes = 1MB
    // accepts images, video, and text formats
    acceptedFiles: 'image/*, video/*, text/*',
    dictDefaultMessage: "Kéo thả file vào đây hoặc click để chọn file",
    dictFileTooBig: "File quá lớn ({{filesize}}MB). Kích thước tối đa: {{maxFilesize}}MB.",
    dictInvalidFileType: "Chỉ chấp nhận file ",
    dictResponseError: "Lỗi server",
    dictCancelUpload: "Hủy",
    dictCancelUploadConfirmation: "Bạn có chắc chắn muốn hủy upload?",
    dictRemoveFile: "Xóa",
    dictFileTooBig: "File quá lớn",
  }
</script>

<button type="submit" id="submitBtn" class="btn btn-primary">Nộp bài dự thi</button>

{% endblock %}